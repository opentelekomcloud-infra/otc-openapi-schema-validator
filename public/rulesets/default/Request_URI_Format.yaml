rules:
  - id: "URI-010-01-2507-2507-M"
    title: The request line must be designed in the format defined by the Uniform Resource Identifier.
    message: |
      The request line is mainly a requirement for a uniform resource identifier (URI).
      A URI is one of the most intuitive content for users to view an interface.
      The definition of a URI must be designed according to the specified format. (OpenStack or community APIs are subject to the native definition.)
      The format of the Uniform Resource Identifier is:
      /{version}/{resources}.
      For APIs that have been released in history, the resource identifier can be defined as follows:
      /{version}/{project_id}/{resources}
      Note: version indicates the interface version, for example, v1. In the inventory resource ID, project_id and tenant_id indicate the project ID.
    option: Mandatory
    location: paths
    element: path
    call:
      function: checkURIFormat
      functionParams: 
        allowedFormats:
          scope:
          - project: "/{version}/{resources}"
          - domain: "/{version}/[project_id/tenant_id]/{resources}"
    description: This rule checks whether defined path is compliant with pred-defined format.
    status: implemented
    severity: high
  
  - id: "URI-010-01-2507-2507-M-1"
    title: The request line must be designed in the format defined by the Uniform Resource Identifier.
    message: |
      The request line is mainly a requirement for a uniform resource identifier (URI).
      A URI is one of the most intuitive content for users to view an interface.
      The definition of a URI must be designed according to the specified format. (OpenStack or community APIs are subject to the native definition.)
      The format of the Uniform Resource Identifier is:
      https://endpoint/{version}/{resources}.
      For APIs that have been released in history, the resource identifier can be defined as follows:
      https://endpoint/{version}/[project_id/tenant_id]/{resources}
      Note: version indicates the interface version, for example, v1. In the inventory resource ID, project_id and tenant_id indicate the project ID.
    option: Mandatory
    location: paths
    element: path
    call:
      function: checkURIFormat
      functionParams: 
        allowedFormats:
          - "/{version}/{resources}"
          - "/{version}/[project_id/tenant_id]/{resources}"
    description: This rule checks whether defined path is compliant with pred-defined format.
    status: planned
    severity: high
  
  - id: "URI-020-01-2507-2507-M-1"
    title: URIs allow only nouns and use lowercase letters. Use few concatenated words.
    message: |
      (1) The total length of the URI and parameters after URI encoding does not exceed 2048 bytes.

    option: Mandatory
    location: paths
    element: path
    call:
      function: checkURILength
      functionParams:
        maxLength: 2048
    description: Check Length of the URI path whether it exceeds 2048 chars.
    status: planned
    severity: critical

  - id: "URI-020-01-2507-2507-M-2"
    title: URIs allow only nouns and use lowercase letters. Use few concatenated words.
    message: |
      (2) Do not use unnecessary abbreviations in URIs (Unless the abbreviation is commonly used in the industry and accompanied by proof of its origin, abbreviations without clear evidence of their source are not permitted.). Ensure that the names of URIs are "Know the meanings of Wangwen" to avoid understanding obstacles. Do not use unusual abbreviations. Use correct words and words with the same meaning across APIs. Helps developers understand APIs.

    option: Mandatory
    location: paths
    element: path
    call:
      function: checkURIContentDictionary
      functionParams:
        checkAbreviations: True
        checkDictionary: True
    description: Check whether URI contains common abbreviations and/or correct words
    status: planned
    severity: critical

  - id: "URI-020-01-2507-2507-M-3"
    title: URIs allow only nouns and use lowercase letters. Use few concatenated words.
    message: |
      (3) Resource names in URIs must be separated by hyphens (-) and all letters must be lowercase.

    option: Mandatory
    location: paths
    element: path
    call:
      function: checkURIContentSyntax
      functionParams:
        requiredPathRegexp:
#          - "^/(?:[a-z0-9]+(?:-[a-z0-9]+)*|\{[a-z0-9_]+\})(?:/(?:[a-z0-9]+(?:-[a-z0-9]+)*|\{[a-z0-9_]+\}))*$"
    description: Check whether URI contains only lowercase characters separated by hyphens
    status: planned
    severity: critical

  - id: "URI-030-01-2507-2507-M-1"
    title: If a URI contains special characters for special purposes, escape the characters (% hexadecimal code).
    message: |
      Note: Some characters have special meanings or are reserved by the system and are easily blocked by the network firewall.
      As a result, URI invoking does not take effect. Therefore, it is not recommended that you use characters in URIs. If necessary, replace them with escape codes:
      . – Reserved in the path component
      .. – Reserved in the path component
      # – Reserved as the fragment delimiter
      ? – Reserved as the query-string delimiter
      ; – Reserved as the params delimiter
      : – Reserved to delimit the scheme, user/password, and host/port components
      $, + – Reserved
      @, &, = – Reserved because they have special meaning in the context of some schemes

    option: Mandatory
    location: paths
    element: path
    call:
      function: checkURIContentSpecial
      functionParams:
        forbiddenChars:
          - ".#?;:$+@&="
    description: Check whether URI contains some forbidden special characters.
    status: planned
    severity: critical

  - id: "URI-030-01-2507-2507-M-2"
    title: If a URI contains special characters for special purposes, escape the characters (% hexadecimal code).
    message: |
      Note: Some characters have special meanings or are reserved by the system and are easily blocked by the network firewall.
      As a result, URI invoking does not take effect. Therefore, it is not recommended that you use characters in URIs. If necessary, replace them with escape codes:
      % – Reserved as escape token for encoded characters

    option: Mandatory
    location: paths
    element: path
    call:
      function: checkURIContentEscape
      functionParams:
        requiredPathRegexp:
          - "%(?![0-9A-Fa-f]{2})"
    description: Check whether URI contains proper escape token format when some special characters are needed
    status: planned
    severity: critical

  - id: "URI-030-01-2507-2507-M-3"
    title: If a URI contains special characters for special purposes, escape the characters (% hexadecimal code).
    message: |
      Note: Some characters have special meanings or are reserved by the system and are easily blocked by the network firewall.
      As a result, URI invoking does not take effect. Therefore, it is not recommended that you use characters in URIs. If necessary, replace them with escape codes.
      % – Reserved as escape token for encoded characters

    option: Mandatory
    location: paths
    element: path
    call:
      function: checkURIContentUnicode
    description: Check whether URI contains unicode characterrs
    status: planned
    severity: critical

  - id: "URI-040-01-2507-2507-M"
    title: Resources must use plurals for API 
    message: |
      Note: The resource name in the URI must be in plural form. For modifying, deleting, or querying a specified resource, add the resource_id to the end of resources.
            New APIs must be implemented according to the specifications. Existing APIs that involve compatibility changes can remain unchanged.

    option: Mandatory
    location: paths
    element: path
    call:
      function: checkURIResourceFormat
      functionParams:
        exception: "Non-CRUD operations which use verb at the end of URI. Mostly POST or PUT HTTP methods"
    description: Check whether resource name in URI is in plural for CRUD operation APIs
    status: planned
    severity: critical

  - id: "URI-050-01-2507-2507-M-1"
    title: URI design is simple and clear
    message: |
      Note: Cloud Service APIs follow the Restful style. The URI is designed according to the standard format (URI-010-01-2507-2507-M).
      URI design should be simple and remove unnecessary redundant information.
      New APIs must be implemented according to the specifications. Existing APIs that involve compatibility changes can remain unchanged.
      Example: Excessive fields in URI: GET /v1/app/openapi/cmdb/business/get-business-list, the fields app, openapi, and get-business-list
      in the URI are redundant and can be simplified to GET /v1/cmdb/businesses

    option: Mandatory
    location: paths
    element: path
    call:
      function: checkURIContentComplexity
      functionParams:
        severity:
          - medium: 4
          - high: 5
          - critical: 6
    description: Check whether URI path doesn't contain too many nested delimitations with "/"
    status: planned
    severity: critical

  - id: "URI-050-01-2507-2507-M-2"
    title: URI design is simple and clear
    message: |
      Incorrect URI format: {version} parameter must be always followed by {project_id} parameter in case such parameter is present in URI.
      So path /v2/{project_id}/{engine}/instances is correct while path /v2/{engine}/{project_id}/instances is incorrect

    option: Mandatory
    location: paths
    element: path
    call:
      function: checkURISequence
    description: Check whether URI path contains correct sequence of version and project_id parameter if such parameters are defined
    status: planned
    severity: critical
