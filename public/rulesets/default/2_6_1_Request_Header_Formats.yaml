rules:
  - id: "2.6.1.1"
    title: "Content-Type Header Requirement"
    message: "Content-Type must be set to application/json if the body is present."
    option: Conditional
    location: paths
    element: 
      - headers 
    call: 
      function: headerCheck
      functionParams: 
        header: "Content-Type"
        default_value: "application/json"
        type: "string"
        allowed_values: 
          - "application/json"
          - "application/octet-stream"
          - "multipart/form-data"
        condition: 
            - property: "requestBody",
              exists: true
    severity: "medium"
 
  - id: "2.6.1.2"
    title: "X-SDK-Date Header Requirement"
    message: "X-SDK-Date must follow format YYYYMMDD'T'HHMMSS'Z' if AK/SK authentication is used."
    option: Conditional
    location: paths
    element:
      - headers
    call: 
      function: headerCheck
      functionParams:
        header: "X-SDK-Date"
        regex: "^[0-9]{8}T[0-9]{6}Z$"
        type: "string"
        default_value: null
        condition:
          - property: "security"
            contains:
              - akSkAuth: []
    severity: "medium"
  
  - id: "2.6.1.3"
    title: "Authorization Header Requirement"
    message: "Authorization header must be present if AK/SK authentication is used."
    option: Conditional
    location: paths
    element:
      - headers
    call:
      function: headerCheck
      functionParams:
        header: "Authorization"
        type: "string"
        default_value: null
        condition:
          all:
            - property: "security"
              contains:
                - akSkAuth: []
            - property: "requestHeaders.Authorization"
              exists: true
            - property: "requestHeaders.Authorization"
              matches: "^[a-zA-Z0-9+/=]+$"
    severity: "medium"

  - id: "2.6.1.5"
    title: "X-Auth-Token Header Requirement"
    message: "X-Auth-Token must be present if PKIToken authentication is used."
    option: Conditional
    location: paths
    element:
      - headers
    call:
      function: headerCheck
      functionParams:
        header: "X-Auth-Token"
        type: "string"
        default_value: null
        condition:
          property: "security"
          contains:
            - pkiTokenAuth: []
    severity: "medium"

  - id: "2.6.1.4"
    title: "Host Header Requirement"
    message: "Host header must be present and contain the requested server information, including hostname and optional port."
    option: Conditional
    location: paths
    element:
      - headers
    call:
      function: headerCheck
      functionParams:
        header: "Host"
        type: "string"
        default_value: "hostname:443"
        condition:
          all:
            - property: "security"
              contains:
                - akSkAuth: []
            - property: "requestHeaders.Host"
              exists: true
    severity: "medium"
  
  - id: "2.6.1.6"
    title: "X-Project-Id Header Requirement"
    message: "X-Project-Id must be present if the API request uses AK/SK authentication in the DeC or multi-project scenario."
    option: Conditional
    location: paths
    element:
      - headers
    call:
      function: headerCheck
      functionParams:
        header: "X-Project-Id"
        type: "string"
        default_value: null
        condition:
          all:
            - property: "security"
              contains:
                - akSkAuth: []
            - property: "x-projectScenario"
              in: ["DeC", "multi-project"]
    severity: "medium"

  - id: "2.6.1.7"
    title: "X-Domain-Id Header Requirement"
    message: "X-Domain-Id is optional for global services authenticated by IAM 3.0."
    option: Conditional
    location: paths
    element:
      - headers
    call:
      function: headerCheck
      functionParams:
        header: "X-Domain-Id"
        type: "string"
        default_value: null
        condition:
          property: "security"
          contains:
            - iam3Auth: []
    severity: "medium"

  - id: "2.6.1.8"
    title: "X-Security-Token Header Requirement"
    message: "X-Security-Token is mandatory when using temporary AK/SK authentication for signature."
    option: Conditional
    location: paths
    element:
      - headers
    call:
      function: headerCheck
      functionParams:
        header: "X-Security-Token"
        type: "string"
        default_value: null
        condition:
          property: "security"
          contains:
            - tempAkSkAuth: []
    severity: "medium"


